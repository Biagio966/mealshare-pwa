<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gnammi</title>

  <link rel="apple-touch-icon" href="public/IMG_1849.png">

  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
      background: #f5f7f6;
      margin: 0;
      padding: 20px;
    }

    h1 {
      text-align: center;
      color: #2e7d32;
    }

    .box {
      background: white;
      border-radius: 16px;
      padding: 16px;
      margin-bottom: 20px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.08);
    }

    input, textarea {
      width: 100%;
      padding: 12px;
      margin-top: 10px;
      font-size: 16px;
      border-radius: 10px;
      border: 1px solid #ccc;
    }

    button {
      width: 100%;
      margin-top: 15px;
      padding: 14px;
      font-size: 16px;
      background: #2ecc71;
      color: white;
      border: none;
      border-radius: 12px;
      font-weight: bold;
    }

    .meal-card {
      background: #f9f9f9;
      border-radius: 12px;
      padding: 12px;
      margin-bottom: 10px;
    }
  </style>
</head>

<body>

<h1>üçΩÔ∏è Gnammi</h1>

<label style="font-size:14px;">
  <input type="checkbox" id="accept">
  Accetto <a href="#legal">Avviso legale e Privacy</a>
</label>

<br><br>

<div class="box">
  <h3>Crea un pasto</h3>
  <input id="mealName" placeholder="Nome del pasto">
  <input id="mealCost" placeholder="Costo totale (es. 12.50)">
  <textarea id="mealDesc" placeholder="Descrizione..."></textarea>
  <button onclick="checkAndSave()">Salva</button>
</div>

<div class="box">
  <h3>Pasti salvati</h3>
  <div id="mealsList">Nessun pasto ancora.</div>
</div>

<hr id="legal">

<div style="font-size:12px;color:#555;">
  <h3>Avviso legale</h3>
  <p>
    Gnammi √® una piattaforma informativa che consente agli utenti di condividere
    pasti fatti in casa e di ripartire esclusivamente i costi delle spese sostenute.
  </p>
  <p>
    Gnammi non vende cibo e non svolge attivit√† di ristorazione.
    Gli utenti sono gli unici responsabili dei pasti condivisi.
  </p>
</div>

<script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

const SUPABASE_URL = "https://zboefxtsggvkbinxlyux.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inpib2VmeHRzZ2d2a2JpbnhseXV4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU2NzMzNjQsImV4cCI6MjA4MTI0OTM2NH0.5uQaO-cKGxrdSiZPvjmqZE3jdYo0qo2uDdGUvrpQqEM";

const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

window.checkAndSave = async function () {
  if (!document.getElementById("accept").checked) {
    alert("Devi accettare l‚Äôavviso legale");
    return;
  }
  await saveMeal();
}

async function saveMeal() {
  const name = mealName.value;
  const cost = mealCost.value;
  const desc = mealDesc.value;

  if (!name || !cost) {
    alert("Inserisci nome e costo");
    return;
  }

  const { error } = await supabase
    .from("meals")
    .insert([{ name, cost, description: desc }]);

  if (error) {
    alert(error.message);
  } else {
    mealName.value = "";
    mealCost.value = "";
    mealDesc.value = "";
    loadMeals();
  }
}

async function loadMeals() {
  const { data } = await supabase
    .from("meals")
    .select("*")
    .order("created_at", { ascending: false });

  const list = document.getElementById("mealsList");

  if (!data || data.length === 0) {
    list.innerHTML = "Nessun pasto ancora.";
    return;
  }

  list.innerHTML = data.map(m =>
    `<div class="meal-card">
      <strong>${m.name}</strong><br>
      ‚Ç¨${m.cost}<br>
      ${m.description || ""}
    </div>`
  ).join("");
}

loadMeals();
</script>

</body>
</html>
